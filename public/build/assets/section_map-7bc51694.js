import"./leaflet-svg-shape-markers-8f7f1e58.js";var m=L.tileLayer(window.mapLayerOpenStreet,{minZoom:5}),a=new L.Map("sectionmap",{center:new L.LatLng(.339951,120.373368),zoom:5,attributionControl:!1,fullscreenControl:!0}),l=L.featureGroup(),d=[],s,f=[],_=L.tileLayer(window.mapLayerOpenStreet,{attribution:""});_.addTo(a);L.Control.geocoder().addTo(a);L.control.layers({osm:m.addTo(a),google:L.tileLayer("http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",{attribution:"google"})},{drawlayer:l},{position:"topright",collapsed:!1}).addTo(a);self.drawControlFull=new L.Control.Draw({edit:{featureGroup:l,poly:{allowIntersection:!1}},draw:{polygon:{allowIntersection:!1,showArea:!0},polyline:!1,rectangle:!1,marker:!1,circle:!1,circlemarker:!1}});self.drawControlEdit=new L.Control.Draw({edit:{featureGroup:l,poly:{allowIntersection:!1}},draw:!1});a.on(L.Draw.Event.CREATED,function(o){if(self.Polygon||self.Circle)return alert("You can only create 1 location per geofence"),null;var e=o.layer;if(e._latlng&&e._mRadius)window.circle=e;else if(e._latlngs&&e._bounds){if(f=e._latlngs[0],f.length<4)return alert("Minimum 4 points required!"),null;self.Polygon=e,self.Polygon.setStyle({color:"#16FF00",fillColor:"#16FF00",fillOpacity:.1})}else return swal("Please make 1 Geofencing!","","Warning"),null;self.drawControlFull.remove(),l.addLayer(e);var n="",t="";$.each(self.Polygon._latlngs,function(r,y){$.each(y,function(w,i){w===0&&(t=`${i.lng} ${i.lat}`),n+=`${i.lng} ${i.lat}, `})}),console.log(`${n}${t}`),C(`${n}${t}`)});a.on(L.Draw.Event.DELETED,function(o){var e=o.layers;e.eachLayer(function(n){self.Circle=null,self.Polygon=null,f=[],self.drawControlEdit.remove(),self.drawControlFull.addTo(a)})});function v(o){var e={type:"FeatureCollection",name:"section",features:d};function n(){return{pane:"pane_Section",shape:"circle",radius:4,opacity:1,color:"#F6FA70",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!1,fillOpacity:1,fillColor:"#F6FA70",interactive:!1}}o.createPane("pane_Section"),o.getPane("pane_Section").style.zIndex=402,o.getPane("pane_Section").style["mix-blend-mode"]="normal",s=new L.geoJson(e,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",pointToLayer:function(t,r){return L.shapeMarker(r,n())}}),o.addLayer(s)}var c=0;$("input[name='ckScanPoints']").change(function(){c=0,a.removeLayer(l),a.removeControl(drawControlFull)});$("input[name='ckAddPoints']").change(function(){c=1,a.removeLayer(l),a.removeControl(drawControlFull)});$("input[name='ckDelPoints']").change(function(){c=2,l.addTo(a),a.addControl(drawControlFull)});function S(o){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("latlng",o),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/add`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){},success:function(n){var t=n.msg;t.code===200?toastr.success("Saved.","Success"):toastr.error(n.msg.obj,"Error")}})}var u=0,p=0;function C(o){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("latlng",o),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/delete`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(n){$("#formSection").css("opacity","");var t=n.msg;t.code===200?(toastr.success("Point deleted.","Success"),g(u,p),a.removeLayer(self.Polygon)):(console.log(n),toastr.error(n.msg.obj,"Error"))}})}L.DomUtil.addClass(a._container,"crosshair-cursor-enabled");a.on("click",function(o){u=o.latlng.lat,p=o.latlng.lng;var e={lat:o.latlng.lat,lng:o.latlng.lng};switch(c){case 0:g(u,p);break;case 1:var n=window._newMarker(e,{icon:L.icon({iconUrl:"/assets/images/leaflet/marker-reddot.png",iconSize:[8,16],iconAnchor:[5,14]}),interactive:!1});n.addTo(a),S(JSON.stringify(n._latlng));break;case 2:break;default:console.log("No Action")}});function g(o,e){s&&a.removeLayer(s),d=[],$.get(`${window.burl}/devtools/js/tollsectionpoint?latlng=${o},${e}`,function(n){$.each(n.data,function(t,r){d.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[parseFloat(r.fflon),parseFloat(r.fflat)]}})}),n.data.length!=0&&v(a)})}
