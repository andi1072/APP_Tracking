import"./leaflet-svg-shape-markers-8f7f1e58.js";var v=L.tileLayer(window.mapLayerOpenStreet,{minZoom:5}),a=new L.Map("sectionmap",{center:new L.LatLng(.339951,120.373368),zoom:5,attributionControl:!1,fullscreenControl:!0}),i=L.featureGroup(),y=[],u,m=[],S=L.tileLayer(window.mapLayerOpenStreet,{attribution:""});S.addTo(a);L.Control.geocoder().addTo(a);L.control.layers({osm:v.addTo(a),google:L.tileLayer("http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",{attribution:"google"})},{drawlayer:i},{position:"topright",collapsed:!1}).addTo(a);self.drawControlFull=new L.Control.Draw({edit:{featureGroup:i,poly:{allowIntersection:!1}},draw:{polygon:{allowIntersection:!1,showArea:!0},polyline:!1,rectangle:!1,marker:!1,circle:!1,circlemarker:!1}});self.drawControlEdit=new L.Control.Draw({edit:{featureGroup:i,poly:{allowIntersection:!1}},draw:!1});a.on(L.Draw.Event.CREATED,function(o){var e=o.layer;if(e._latlng&&e._mRadius)window.circle=e;else if(e._latlngs&&e._bounds){if(m=e._latlngs[0],m.length<4)return alert("Minimum 4 points required!"),null;self.Polygon=e,self.Polygon.setStyle({color:"#16FF00",fillColor:"#16FF00",fillOpacity:.1})}else return swal("Please make 1 Geofencing!","","Warning"),null;self.drawControlFull.remove(),i.addLayer(self.Polygon);var n="",t="";$.each(self.Polygon._latlngs,function(s,w){$.each(w,function(_,d){_===0&&(t=`${d.lng} ${d.lat}`),n+=`${d.lng} ${d.lat}, `})}),console.log(`${n}${t}`),F(`${n}${t}`)});a.on(L.Draw.Event.DELETED,function(o){var e=o.layers;e.eachLayer(function(n){self.Circle=null,self.Polygon=null,m=[],self.drawControlEdit.remove(),self.drawControlFull.addTo(a)})});function h(o){var e={type:"FeatureCollection",name:"section",features:y};function n(){return{pane:"pane_Section",shape:"circle",radius:4,opacity:1,color:"#F6FA70",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!1,fillOpacity:1,fillColor:"#F6FA70",interactive:!1}}o.createPane("pane_Section"),o.getPane("pane_Section").style.zIndex=402,o.getPane("pane_Section").style["mix-blend-mode"]="normal",u=new L.geoJson(e,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",pointToLayer:function(t,s){return L.shapeMarker(s,n())}}),o.addLayer(u)}var p=0;$("input[name='ckScanPoints']").change(function(){p=0,a.removeLayer(i),a.removeControl(drawControlFull),g(),c(l,r)});$("input[name='ckAddPoints']").change(function(){p=1,a.removeLayer(i),a.removeControl(drawControlFull),g(),c(l,r)});$("input[name='ckDelPoints']").change(function(){p=2,a.addControl(drawControlFull),g(),c(l,r)});function C(o){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("latlng",o),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/add`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){},success:function(n){var t=n.msg;t.code===200?toastr.success("Saved.","Success"):toastr.error(n.msg.obj,"Error")}})}var l=0,r=0,f=[];function g(){$.each(f,function(o,e){a.removeLayer(f[o])}),f=[]}function F(o){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("latlng",o),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/delete`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(n){$("#formSection").css("opacity","");var t=n.msg;t.code===200?(toastr.success("Point deleted.","Success"),c(l,r),a.addControl(drawControlFull),a.removeLayer(self.Polygon),g()):toastr.error(n.msg.obj,"Error")}})}L.DomUtil.addClass(a._container,"crosshair-cursor-enabled");a.on("click",function(o){l=o.latlng.lat,r=o.latlng.lng;var e={lat:o.latlng.lat,lng:o.latlng.lng};switch(p){case 0:c(l,r);break;case 1:n&&a.removeLayer(n);var n=window._newMarker(e,{icon:L.icon({iconUrl:"/assets/images/leaflet/marker-reddot.png",iconSize:[8,16],iconAnchor:[5,12]}),interactive:!1});n.addTo(a),f.push(n),C(JSON.stringify(n._latlng));break;case 2:break;default:console.log("No Action")}});function c(o,e){u&&a.removeLayer(u),y=[],$.get(`${window.burl}/devtools/js/tollsectionpoint?latlng=${o},${e}`,function(n){$.each(n.data,function(t,s){y.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[parseFloat(s.fflon),parseFloat(s.fflat)]}})}),n.data.length!=0&&h(a)})}
