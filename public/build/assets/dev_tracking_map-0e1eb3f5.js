import{_ as k}from"./leaflet.rotatedMarker-2d7b659f.js";import"./leaflet-svg-shape-markers-8f7f1e58.js";import"./_commonjsHelpers-725317a4.js";const A="/assets/images/leaflet/toll_gate.png";var i=L.map("devicesmap",{minZoom:5,attributionControl:!1,fullscreenControl:!0}).setView([.33995192349439596,120.3733680354565],5),w=[],b,u=[],F=L.tileLayer(window.mapLayer,{attribution:""});F.addTo(i);$.get(window.burl+"/devtools/js/gate/zone",function(e){$.each(e.data,function(o,a){w.push({type:"Feature",properties:{created_at:a.created_at,fflat:a.fflat,fflon:a.fflon,fnpayment_type:a.fnpayment_type,ftdescription:a.ftdescription,ftname:a.ftname,ftsection:a.ftsection,id:a.id},geometry:{type:"Point",coordinates:[parseFloat(a.fflon),parseFloat(a.fflat)]}}),u.push({type:"Feature",properties:{fntype:a.fntype},geometry:{type:"Polygon",coordinates:[a.polygon]}})}),e.data.length!=0?(G(i),P(i)):console.log("No Data")});function G(e){var o=new L.featureGroup([]),a={type:"FeatureCollection",name:"gate",features:w};function t(s,r){var n=s.properties,p="n/a";n.fnpayment_type===1?p="Open":n.fnpayment_type===2&&(p="Close"),r.bindPopup(`<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">GATE NAME</div><div class="col-7 pl-4">${n.ftname}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SECTION</div><div class="col-7 pl-4">${n.ftsection}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">PAYMENT TYPE</div><div class="col-7 pl-4">${p}</div></div>`,{maxHeight:400}),r.bindTooltip(n.ftname)}e.createPane("pane_Gate"),e.getPane("pane_Gate").style.zIndex=402,e.getPane("pane_Gate").style["mix-blend-mode"]="normal";var d=new L.geoJson(a,{attribution:"",interactive:!0,dataVar:"jGate",layerName:"lGate",pane:"pane_Gate",onEachFeature:t,pointToLayer:function(s,r){return L.marker(r,{icon:L.icon({iconUrl:A,iconSize:[30,30],iconAnchor:[16,25],popupAnchor:[0,-15]})})}});o.addLayer(d),e.addLayer(d),e.fitBounds(o.getBounds())}function P(e){var o={type:"FeatureCollection",name:"polyGates",features:u};function a(t){return t.properties.fntype===1?{pane:"pane_polyGates",opacity:1,color:"#00FFCA",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:1,fillOpacity:1,interactive:!0}:{pane:"pane_polyGates",opacity:1,color:"#ED2B2A",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:1,fillOpacity:1,interactive:!0}}e.createPane("pane_polyGates"),e.getPane("pane_polyGates").style.zIndex=401,e.getPane("pane_polyGates").style["mix-blend-mode"]="normal",b=new L.geoJson(o,{attribution:"",interactive:!0,dataVar:"json_polyGates",layerName:"layer_polyGates",pane:"pane_polyGates",style:a,pointToLayer:function(t,d){return window._newMarker(d,{icon:L.icon({iconUrl:window.gateUrl,iconSize:[30,30],iconAnchor:[8,25],popupAnchor:[0,-20]})},t.properties.gate_name,`<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">GATE NAME</div><div class="col-7 pl-4">${t.properties.gate_name}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SECTION</div><div class="col-7 pl-4">${t.properties.ftsection}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DECLARE</div><div class="col-7 pl-4">${t.properties.ftdeclaration_type}</div></div>`)}}),e.addLayer(b)}var f,c,v="",_=[],m,h,l,y=0;$("#formMapTrackDev").submit(function(e){if(e.preventDefault(),_dtfrom=$("input[name=txtdtfrom]").val(),_dtto=$("input[name=txtdtto]").val(),v==="")return toastr.warning("Please select the Device.","Validation"),null;c=[],_=[],f&&(i.removeLayer(f),i.removeLayer(h)),m&&clearInterval(m),$.get(`${window.burl}/tracking/detail/js/map?did=${v}&from=${_dtfrom}&to=${_dtto}&humanTz=${window.dtHumanName()}`,function(o){$.each(o.relay.data,function(a,t){c.push({type:"Feature",properties:{created_at:t.created_at,ffaccuracy_cep:t.ffaccuracy_cep,ffaltitude:t.ffaltitude,ffbattery:t.ffbattery,ffdirection:t.ffdirection,fflat:t.fflat,fflon:t.fflon,ffspeed:t.ffspeed},geometry:{type:"Point",coordinates:[parseFloat(t.fflon),parseFloat(t.fflat)]}}),_.push([parseFloat(t.fflon),parseFloat(t.fflat)])}),$.each(o.relay.geo_gate,function(a,t){u.push({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[t.polygon]}}),u.push({type:"Feature",properties:t,geometry:{type:"Point",coordinates:[t.gate_lon,t.gate_lat]}})}),o.relay.data.length!=0?(T(),C(),x()):toastr.info("Vehicle tracking not found.","Information")})});function T(){var e=new L.featureGroup([]),o={type:"FeatureCollection",name:"relay",features:c};function a(){return{pane:"pane_Relay",shape:"circle",radius:4,opacity:1,color:"#CF0A0A",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!0,fillOpacity:1,fillColor:"#FF0032",interactive:!0}}function t(d,s){var r=d.properties,n="n/a";g(parseInt(r.fnsignal),0,10)?n="Poor":g(parseInt(r.fnsignal),11,20)?n="Good":g(parseInt(r.fnsignal),21,31)&&(n="Excelent");var p='<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">DATE TIME</div><div class="col-7 pl-4">'+window.dtHumanParse(r.created_at)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ALT (Meters)</div><div class="col-7 pl-4">'+parseFloat(parseFloat(r.ffaltitude)/3.2808).toFixed(2)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SPEED</div><div class="col-7 pl-4">'+r.ffspeed+'Km/h</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ACCURACY (CEP)</div><div class="col-7 pl-4">'+r.ffaccuracy_cep+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SIGNAL</div><div class="col-7 pl-4">'+r.fnsignal+" ("+n+')</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DIRECTION</div><div class="col-7 pl-4">'+r.ffdirection+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">COORDINATE</div><div class="col-7 pl-4">'+r.fflat.toString()+", "+r.fflon.toString()+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SATTELITE</div><div class="col-7 pl-4">'+r.fnsattelite+"</div></div>";s.bindPopup(p,{maxHeight:400}),s.bindTooltip(window.dtHumanParse(r.created_at)).openTooltip()}i.createPane("pane_Relay"),i.getPane("pane_Relay").style.zIndex=402,i.getPane("pane_Relay").style["mix-blend-mode"]="normal",f=new L.geoJson(o,{attribution:"",interactive:!0,dataVar:"jRelay",layerName:"lRelay",pane:"pane_Relay",onEachFeature:t,pointToLayer:function(d,s){return L.shapeMarker(s,a())}}),e.addLayer(f),i.addLayer(f),i.fitBounds(e.getBounds())}function C(){var e={type:"FeatureCollection",name:"line_relay",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:_}}]};function o(a){return{pane:"pane_line_relay",opacity:1,color:"#FF0032",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:1,fillOpacity:0,interactive:!0}}i.createPane("pane_line_relay"),i.getPane("pane_line_relay").style.zIndex=401,i.getPane("pane_line_relay").style["mix-blend-mode"]="normal",h=new L.geoJson(e,{attribution:"",interactive:!0,dataVar:"json_line_relay",layerName:"layer_line_relay",pane:"pane_line_relay",style:o}),i.addLayer(h)}function x(){y=0;var e=c[0];l&&i.removeLayer(l),l=new k([e.geometry.coordinates[1],e.geometry.coordinates[0]],{draggable:!1,riseOnHover:!0,icon:L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],tooltipAnchor:[0,-15]})}).addTo(i),m=setInterval(function(){var o=c[y];l.slideTo([o.geometry.coordinates[1],o.geometry.coordinates[0]],{duration:1e3,keepAtCenter:!1}),l.setIcon(L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],tooltipAnchor:[16,0]})),l.setRotationAngle(o.properties.ffdirection),l.setRotationOrigin("center center"),l.bindTooltip(`Speed: ${o.properties.ffspeed} Km/h`,{position:"bottom"}),l.openTooltip(),y++,y===c.length&&(clearInterval(m),x())},500)}$("#sel_device").select2();axios.get(`${window.burl}/devtools/js/sel_device`).then(e=>{$("#sel_device").select2({data:e.data.devices,placeholder:"Select device...",width:"style"})}).catch(e=>{console.log(e)});$("#sel_device").on("change",function(){v=$("#sel_device").val()});function g(e,o,a){return e>=o&&e<=a}
