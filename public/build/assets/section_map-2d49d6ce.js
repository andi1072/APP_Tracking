import"./leaflet-svg-shape-markers-8f7f1e58.js";import{s as v}from"./sweetalert.min-9dab74b7.js";import"./_commonjsHelpers-725317a4.js";var h=L.tileLayer(window.mapLayerOpenStreet,{minZoom:5}),o=new L.Map("sectionmap",{center:new L.LatLng(.339951,120.373368),zoom:5,attributionControl:!1,fullscreenControl:!0}),m=L.featureGroup(),w=[],g,_=[],S=L.tileLayer(window.mapLayerOpenStreet,{attribution:""});S.addTo(o);L.Control.geocoder().addTo(o);L.control.layers({osm:h.addTo(o),google:L.tileLayer("http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",{attribution:"google"})},{},{position:"topright",collapsed:!1}).addTo(o);self.drawControlFull=new L.Control.Draw({edit:{featureGroup:m,poly:{allowIntersection:!1}},draw:{polygon:{allowIntersection:!1,showArea:!0},polyline:!1,rectangle:!1,marker:!1,circle:!1,circlemarker:!1}});self.drawControlEdit=new L.Control.Draw({edit:{featureGroup:m,poly:{allowIntersection:!1}},draw:!1});o.on(L.Draw.Event.CREATED,function(n){var t=n.layer;if(t._latlng&&t._mRadius)window.circle=t;else if(t._latlngs&&t._bounds){if(_=t._latlngs[0],_.length<4)return toastr.error("Minimum 4 points required!","Error"),null;self.Polygon=t,self.Polygon.setStyle({color:"#16FF00",fillColor:"#16FF00",fillOpacity:.1})}else return toastr.error("Please make 1 Geofencing!","Error"),null;self.drawControlFull.remove(),m.addLayer(self.Polygon);var e="",l="";if($.each(self.Polygon._latlngs,function(r,s){$.each(s,function(i,a){i===0&&(l=`${a.lng} ${a.lat}`),e+=`${a.lng} ${a.lat}, `})}),console.log(`${e}${l}`),e)switch(u){case 2:T(`${e}${l}`);break;case 3:v({closeOnConfirm:!1,closeOnCancel:!1,content:{element:"input",attributes:{placeholder:"Type section name",type:"text"}}}).then(a=>{a?k(a,`${e}${l}`):(d(c,f),o.addControl(drawControlFull),o.removeLayer(self.Polygon),p())});break;case 4:const r=document.createElement("input"),s=document.createElement("label");r.type="checkbox",r.id="ckflyover",s.for="ckflyover",s.innerHTML="&nbsp;Set Point for Flyover";const i=document.createElement("div");i.append(r),i.append(s),v({closeOnConfirm:!1,closeOnCancel:!1,content:i}).then(a=>{console.log(a?"A":"B",a)});break}else toastr.error("Failed to read LatLng.")});o.on(L.Draw.Event.DELETED,function(n){var t=n.layers;t.eachLayer(function(e){self.Circle=null,self.Polygon=null,_=[],self.drawControlEdit.remove(),self.drawControlFull.addTo(o)})});function b(n){var t={type:"FeatureCollection",name:"section",features:w},e={};function l(s){let i="#16FF00",a=s.properties;return a.ftsection_name&&(e[a.ftsection_name]||(e[a.ftsection_name]=window.randomHexColor()),i=e[a.ftsection_name]),{pane:"pane_Section",shape:"circle",radius:4,opacity:1,color:i,dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!0,fillOpacity:1,fillColor:i,interactive:!0}}function r(s,i){let a=s.properties,C=`<ul style="list-style-type: none; margin: 0; padding: 0;">
        <li style="font-weight: bold;">Name: ${a.ftsection_name}</li>
        <li style="font-weight: bold;">Type: ${a.fbfly_over?"Flyover":"Street"}</li>
        <li style="font-weight: bold;">Elevation: ${a.ffelevation?a.ffelevation:"n/a"} Meter</li>`;a.ftsection_name&&i.bindTooltip(C).openTooltip()}n.createPane("pane_Section"),n.getPane("pane_Section").style.zIndex=402,n.getPane("pane_Section").style["mix-blend-mode"]="normal",g=new L.geoJson(t,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",onEachFeature:r,pointToLayer:function(s,i){return L.shapeMarker(i,l(s))}}),n.addLayer(g)}var u=0;$("input[name='ckScanPoints']").change(function(){u=0,o.removeLayer(m),o.removeControl(drawControlFull),p(),d(c,f)});$("input[name='ckAddPoints']").change(function(){u=1,o.removeLayer(m),o.removeControl(drawControlFull),p(),d(c,f)});$("input[name='ckDelPoints']").change(function(){u=2,o.addControl(drawControlFull),p(),d(c,f)});$("input[name='ckAddTollSection']").change(function(){u=3,o.addControl(drawControlFull),p(),d(c,f)});$("input[name='ckFlyOverLocation']").change(function(){u=4,o.addControl(drawControlFull),p(),d(c,f)});function F(n){var t=new FormData;t.append("_token",$("input[name=_token]").val()),t.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/add`,data:t,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){},success:function(e){var l=e.msg;l.code===200?toastr.success("Saved.","Success"):toastr.error(e.msg.obj,"Error")}})}var c=0,f=0,y=[];function p(){$.each(y,function(n,t){o.removeLayer(y[n])}),y=[]}function T(n){var t=new FormData;t.append("_token",$("input[name=_token]").val()),t.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/delete`,data:t,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(e){$("#formSection").css("opacity","");var l=e.msg;l.code===200?(toastr.success("Point deleted.","Success"),d(c,f),o.addControl(drawControlFull),o.removeLayer(self.Polygon),p()):toastr.error(e.msg.obj,"Error")}})}function k(n,t){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("section_name",n),e.append("latlng",t),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/set_section`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(l){console.log("res",l),toastr.success("","Success"),d(c,f),o.addControl(drawControlFull),o.removeLayer(self.Polygon),p()},error:function(l){console.log(l);let r=JSON.parse(l.responseText);toastr.error(r.error,"Error")},complete:function(){$("#formSection").css("opacity","")}})}L.DomUtil.addClass(o._container,"crosshair-cursor-enabled");o.on("click",function(n){c=n.latlng.lat,f=n.latlng.lng;var t={lat:n.latlng.lat,lng:n.latlng.lng};switch(u){case 0:d(c,f);break;case 1:e&&o.removeLayer(e);var e=window._newMarker(t,{icon:L.icon({iconUrl:"/assets/images/leaflet/marker-reddot.png",iconSize:[8,16],iconAnchor:[5,12]}),interactive:!1});e.addTo(o),y.push(e),F(JSON.stringify(e._latlng));break}});function d(n,t){g&&o.removeLayer(g),w=[],$.get(`${window.burl}/devtools/js/tollsectionpoint?latlng=${n},${t}`,function(e){$.each(e.data,function(l,r){w.push({type:"Feature",properties:{ftsection_name:r.ftsection_name,ffelevation:r.ffelevation,fbfly_over:r.fbfly_over},geometry:{type:"Point",coordinates:[parseFloat(r.fflon),parseFloat(r.fflat)]}})}),e.data.length!=0&&b(o)})}
