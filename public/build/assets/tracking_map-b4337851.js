import{_ as T}from"./leaflet.rotatedMarker-2d7b659f.js";import"./leaflet-svg-shape-markers-8f7f1e58.js";import"./_commonjsHelpers-725317a4.js";const F=window.burl;var g,_,h,e=L.map("trackingmap",{minZoom:5,fullscreenControl:!0,attributionControl:!1}).setView([.33995192349439596,120.3733680354565],5),w=L.tileLayer(window.mapLayer);w.addTo(e);L.control.layers({osm:w.addTo(e),google:L.tileLayer("http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",{attribution:"google"})},{},{position:"topright",collapsed:!1}).addTo(e);var d,u,l=[],m=[],b,x=[];$("#formMapTrack").submit(function(r){r.preventDefault(),g=$("input[name=device_id]").val(),_=$("input[name=txtdtfrom]").val(),h=$("input[name=txtdtto]").val(),l=[],m=[],d&&(e.removeLayer(d),e.removeLayer(u)),y&&clearInterval(y),$.get(F+`/tracking/detail/js/map?did=${g}&from=${_}&to=${h}&humanTz=${window.dtHumanName()}`,function(a){$.each(a.relay.data,function(i,t){l.push({type:"Feature",properties:{created_at:t.created_at,ffaccuracy_cep:t.ffaccuracy_cep,ffaltitude:t.ffaltitude,ffbattery:t.ffbattery,ffdirection:t.ffdirection,fflat:t.fflat,fflon:t.fflon,ffspeed:t.ffspeed},geometry:{type:"Point",coordinates:[parseFloat(t.fflon),parseFloat(t.fflat)]}}),m.push([parseFloat(t.fflon),parseFloat(t.fflat)])}),$.each(a.relay.geo_gate,function(i,t){x.push({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[t.polygon]}})}),a.relay.data.length!=0?(I(),R(),k(),C()):toastr.info("Vehicle tracking not found.","Information")})});function I(){var r=new L.featureGroup([]),a={type:"FeatureCollection",name:"relay",features:l};function i(){return{pane:"pane_Relay",shape:"circle",radius:4,opacity:1,color:"#CF0A0A",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!0,fillOpacity:1,fillColor:"#FF0032",interactive:!0}}function t(v,s){var o=v.properties,c="n/a";f(parseInt(o.fnsignal),0,10)?c="Poor":f(parseInt(o.fnsignal),11,20)?c="Good":f(parseInt(o.fnsignal),21,31)&&(c="Excelent");var A='<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">DATE TIME</div><div class="col-7 pl-4">'+window.dtHumanParse(o.created_at)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ALT (Meters)</div><div class="col-7 pl-4">'+parseFloat(parseFloat(o.ffaltitude)/3.2808).toFixed(2)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SPEED</div><div class="col-7 pl-4">'+o.ffspeed+'Km/h</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ACCURACY (CEP)</div><div class="col-7 pl-4">'+o.ffaccuracy_cep+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SIGNAL</div><div class="col-7 pl-4">'+o.fnsignal+" ("+c+')</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DIRECTION</div><div class="col-7 pl-4">'+o.ffdirection+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">COORDINATE</div><div class="col-7 pl-4">'+o.fflat.toString()+", "+o.fflon.toString()+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SATTELITE</div><div class="col-7 pl-4">'+o.fnsattelite+"</div></div>";s.bindPopup(A,{maxHeight:400}),s.bindTooltip(window.dtHumanParse(o.created_at)).openTooltip()}e.createPane("pane_Relay"),e.getPane("pane_Relay").style.zIndex=402,e.getPane("pane_Relay").style["mix-blend-mode"]="normal",d=new L.geoJson(a,{attribution:"",interactive:!0,dataVar:"jRelay",layerName:"lRelay",pane:"pane_Relay",onEachFeature:t,pointToLayer:function(v,s){return L.shapeMarker(s,i())}}),r.addLayer(d),e.addLayer(d),e.fitBounds(r.getBounds())}function R(){var r={type:"FeatureCollection",name:"line_relay",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:m}}]};function a(i){return{pane:"pane_line_relay",opacity:1,color:"#FF0032",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:1,fillOpacity:0,interactive:!0}}e.createPane("pane_line_relay"),e.getPane("pane_line_relay").style.zIndex=401,e.getPane("pane_line_relay").style["mix-blend-mode"]="normal",u=new L.geoJson(r,{attribution:"",interactive:!0,dataVar:"json_line_relay",layerName:"layer_line_relay",pane:"pane_line_relay",style:a}),e.addLayer(u)}function C(){var r={type:"FeatureCollection",name:"polyGates",features:x};function a(i){return{pane:"pane_polyGates",opacity:1,color:"#8F43EE",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:2,fillOpacity:0,interactive:!0}}e.createPane("pane_polyGates"),e.getPane("pane_polyGates").style.zIndex=401,e.getPane("pane_polyGates").style["mix-blend-mode"]="normal",b=new L.geoJson(r,{attribution:"",interactive:!0,dataVar:"json_polyGates",layerName:"layer_polyGates",pane:"pane_polyGates",style:a,pointToLayer:function(i,t){return window._newMarker(t,{icon:L.icon({iconUrl:window.gateUrl,iconSize:[30,30],iconAnchor:[8,25],popupAnchor:[0,-20]})},i.properties.gate_name,`<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">GATE NAME</div><div class="col-7 pl-4">${i.properties.gate_name}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SECTION</div><div class="col-7 pl-4">${i.properties.ftsection}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DECLARE</div><div class="col-7 pl-4">${i.properties.ftdeclaration_type}</div></div>`)}}),e.addLayer(b)}function f(r,a,i){return r>=a&&r<=i}var n,p=0,y;function k(){p=0;var r=l[0];n&&e.removeLayer(n),n=new T([r.geometry.coordinates[1],r.geometry.coordinates[0]],{draggable:!1,riseOnHover:!0,icon:L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],tooltipAnchor:[0,-15]})}).addTo(e),y=setInterval(function(){var a=l[p];n.slideTo([a.geometry.coordinates[1],a.geometry.coordinates[0]],{duration:1e3,keepAtCenter:!1}),n.setIcon(L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],tooltipAnchor:[16,0]})),n.setRotationAngle(a.properties.ffdirection),n.setRotationOrigin("center center"),n.bindTooltip(`Speed: ${a.properties.ffspeed} Km/h`,{position:"bottom"}),n.openTooltip(),p++,p===l.length&&(clearInterval(y),k())},500)}
