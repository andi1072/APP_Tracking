var e,r,d=new L.featureGroup([]),s,c,f=$("#tblmlff_sec").DataTable({lengthChange:!1,order:[[1,"desc"]],scrollX:!0,columnDefs:[{visible:!1,targets:[0]},{targets:-1,defaultContent:'<button class="btnview btn btn-pure btn-primary icon md-view waves-effect waves-classic">Log</button>'}]}),u=null;$("#tblmlff_sec tbody").on("click","button.btnview",function(){var a=f.row($(this).parents("tr")).data();u=a[0],$("#modallog").modal("show"),console.log(a[0])});var _=$("input[name=_deviceid]").val();console.log(_);axios.get(`${window.burl}/devtools/mlff/js/history/section?did=${_}`).then(a=>{a.data.data.length<=0||$.each(a.data.data,function(n,t){var l="-",i="-";t.fdexit_time&&(l=window.dtHumanParse(t.fdexit_time),i=t.ftexit_location),f.row.add([t.id,window.dtHumanParse(t.fdentry_time),t.ftentry_location,l,i]).draw(!0)})}).catch(a=>{console.log(a)});$("#modallog").on("shown.bs.modal",function(){if(!e){e=L.map("trackingmlff_log",{minZoom:5,fullscreenControl:!0,attributionControl:!1}).setView([.33995192349439596,120.3733680354565],5);var a=L.tileLayer(window.mapLayer);a.addTo(e)}$.get(`${window.burl}/devtools/mlff/js/history/section/log?section_history=${u}`,function(n){console.log(n.data.data);var t=n.data.data;n.data.routes&&m(t,n.data.routes)})});$("#modallog").on("hidden.bs.modal",function(){e.removeLayer(r),s&&e.removeLayer(s),c&&e.removeLayer(c),e.removeLayer(d)});function m(a,n){var t={type:"FeatureCollection",name:"line_relay",features:[{type:"Feature",properties:a,geometry:{type:"LineString",coordinates:n}}]};function l(i){d=new L.featureGroup([]);var o=i.properties;return s=window._newMarker({lat:parseFloat(o.ffentry_lat),lng:parseFloat(o.ffentry_lon)},{icon:L.icon({iconUrl:`${window.burl}/assets/images/leaflet/entry.png`,iconSize:[40,40],iconAnchor:[19,34],popupAnchor:[0,-15]})},o.gate_name,null).addTo(e),o.fdexit_time&&(c=window._newMarker({lat:parseFloat(o.ffexit_lat),lng:parseFloat(o.ffexit_lon)},{icon:L.icon({iconUrl:`${window.burl}/assets/images/leaflet/exit.png`,iconSize:[40,40],iconAnchor:[19,34],popupAnchor:[0,-15]})},o.gate_name,null).addTo(e)),{pane:"pane_line_relay",opacity:1,color:"#FF0032",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:1,fillOpacity:0,interactive:!0}}e.createPane("pane_line_relay"),e.getPane("pane_line_relay").style.zIndex=401,e.getPane("pane_line_relay").style["mix-blend-mode"]="normal",r=new L.geoJson(t,{attribution:"",interactive:!0,dataVar:"json_line_relay",layerName:"layer_line_relay",pane:"pane_line_relay",style:l}),d.addLayer(r),e.addLayer(r),e.fitBounds(d.getBounds())}
