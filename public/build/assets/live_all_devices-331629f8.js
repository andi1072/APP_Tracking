import{_}from"./leaflet.rotatedMarker-2d7b659f.js";import"./leaflet-svg-shape-markers-8f7f1e58.js";import"./_commonjsHelpers-725317a4.js";const u=window.burl,b="/assets/images/leaflet/toll_gate.png";var n=L.map("devicesmap",{minZoom:5,attributionControl:!1,fullscreenControl:!0}).setView([.33995192349439596,120.3733680354565],5),d=new L.FeatureGroup,y={},f=[],m,w=function(e){return L.icon({iconUrl:e,iconSize:window.c_marker_front_cfg[0],iconAnchor:window.c_marker_front_cfg[1],popupAnchor:window.c_marker_front_cfg[2]})},x=function(){return Math.floor(Math.random()*16777215).toString(16)},v=[],g,h=[],k=L.tileLayer(window.mapLayer,{attribution:""});k.addTo(n);var G=function(e){return`<h3 class="h6 d-block text-uppercase font-weight-bold">${e.ftdevice_name}</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">Last Update</div><div class="col-7 pl-4">${window.dtHumanParse(e.created_at)}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">Vehicle ID</div><div class="col-7 pl-4">${e.ftasset_id}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">Vehicle Name</div><div class="col-7 pl-4">${e.ftasset_name}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark"></div>`};$.get(u+"/devtools/monitor/js/devices",function(e){$.each(e.data.data,function(a,t){var o=new _([t.fflat,t.fflon],{draggable:!1,riseOnHover:!0,icon:w(window.c_marker_front)});o.bindTooltip(t.ftasset_id).openTooltip();var r=L.popup().setContent(G(t));o.bindPopup(r,{className:"custom-popup"}).openPopup(),y[t.ftdevice_id]=o,y[t.ftdevice_id].__pathColor=`#${x()}`,o.addTo(n),d.addLayer(o),d.addTo(n)}),e.data.data.length!=0?n.fitBounds(d.getBounds()):console.log("No Data")});$.get(u+"/devtools/js/gate/zone",function(e){$.each(e.data,function(a,t){v.push({type:"Feature",properties:{created_at:t.created_at,fflat:t.fflat,fflon:t.fflon,fnpayment_type:t.fnpayment_type,ftdescription:t.ftdescription,ftname:t.ftname,ftsection:t.ftsection,id:t.id},geometry:{type:"Point",coordinates:[parseFloat(t.fflon),parseFloat(t.fflat)]}}),h.push({type:"Feature",properties:{fntype:t.fntype},geometry:{type:"Polygon",coordinates:[t.polygon]}})}),e.data.length!=0?(P(n),S(n)):console.log("No Data")});var p;n.on("click",function(e){f=[];var a=e.latlng.lat,t=e.latlng.lng;p&&n.removeLayer(p),p=L.circle([a,t],1e4).addTo(n),$.get(`${u}/devtools/js/tollsectionpoint?latlng=${a},${t}`,function(o){$.each(o.data,function(r,i){f.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[parseFloat(i.fflon),parseFloat(i.fflat)]}})}),o.data.length!=0&&A(n)})});function P(e){var a=new L.featureGroup([]),t={type:"FeatureCollection",name:"relay",features:v};function o(i,c){var l=i.properties,s="n/a";l.fnpayment_type===1?s="Open":l.fnpayment_type===2&&(s="Close"),c.bindPopup(`<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">GATE NAME</div><div class="col-7 pl-4">${l.ftname}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SECTION</div><div class="col-7 pl-4">${l.ftsection}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">PAYMENT TYPE</div><div class="col-7 pl-4">${s}</div></div>`,{maxHeight:400}),c.bindTooltip(l.ftname)}e.createPane("pane_Gate"),e.getPane("pane_Gate").style.zIndex=402,e.getPane("pane_Gate").style["mix-blend-mode"]="normal";var r=new L.geoJson(t,{attribution:"",interactive:!0,dataVar:"jGate",layerName:"lGate",pane:"pane_Gate",onEachFeature:o,pointToLayer:function(i,c){return L.marker(c,{icon:L.icon({iconUrl:b,iconSize:[30,30],iconAnchor:[16,25],popupAnchor:[0,-15]})})}});a.addLayer(r),e.addLayer(r),e.fitBounds(a.getBounds())}function S(e){var a={type:"FeatureCollection",name:"polyGates",features:h};function t(o){return o.properties.fntype===1?{pane:"pane_polyGates",opacity:1,color:"#00FFCA",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:2,fillOpacity:1,interactive:!0}:{pane:"pane_polyGates",opacity:1,color:"#ED2B2A",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:2,fillOpacity:1,interactive:!0}}e.createPane("pane_polyGates"),e.getPane("pane_polyGates").style.zIndex=401,e.getPane("pane_polyGates").style["mix-blend-mode"]="normal",g=new L.geoJson(a,{attribution:"",interactive:!0,dataVar:"json_polyGates",layerName:"layer_polyGates",pane:"pane_polyGates",style:t,pointToLayer:function(o,r){return window._newMarker(r,{icon:L.icon({iconUrl:window.gateUrl,iconSize:[30,30],iconAnchor:[8,25],popupAnchor:[0,-20]})},o.properties.gate_name,`<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">GATE NAME</div><div class="col-7 pl-4">${o.properties.gate_name}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SECTION</div><div class="col-7 pl-4">${o.properties.ftsection}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DECLARE</div><div class="col-7 pl-4">${o.properties.ftdeclaration_type}</div></div>`)}}),e.addLayer(g)}function A(e){var a={type:"FeatureCollection",name:"section",features:f};function t(){return{pane:"pane_Section",shape:"circle",radius:4,opacity:1,color:"#000000",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!1,fillOpacity:1,fillColor:"#000000",interactive:!0}}e.createPane("pane_Section"),e.getPane("pane_Section").style.zIndex=402,e.getPane("pane_Section").style["mix-blend-mode"]="normal",m=new L.geoJson(a,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",pointToLayer:function(o,r){return L.shapeMarker(r,t())}}),e.addLayer(m)}
