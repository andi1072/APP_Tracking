import"./leaflet-svg-shape-markers-8f7f1e58.js";import{s as S}from"./sweetalert.min-9dab74b7.js";import"./_commonjsHelpers-725317a4.js";var C=L.tileLayer(window.mapLayerOpenStreet,{minZoom:5}),t=new L.Map("sectionmap",{center:new L.LatLng(.339951,120.373368),zoom:5,attributionControl:!1,fullscreenControl:!0}),y=L.featureGroup(),w=[],g,_=[],h=L.tileLayer(window.mapLayerOpenStreet,{attribution:""});h.addTo(t);L.Control.geocoder().addTo(t);L.control.layers({osm:C.addTo(t),google:L.tileLayer("http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",{attribution:"google"})},{},{position:"topright",collapsed:!1}).addTo(t);self.drawControlFull=new L.Control.Draw({edit:{featureGroup:y,poly:{allowIntersection:!1}},draw:{polygon:{allowIntersection:!1,showArea:!0},polyline:!1,rectangle:!1,marker:!1,circle:!1,circlemarker:!1}});self.drawControlEdit=new L.Control.Draw({edit:{featureGroup:y,poly:{allowIntersection:!1}},draw:!1});t.on(L.Draw.Event.CREATED,function(n){var o=n.layer;if(o._latlng&&o._mRadius)window.circle=o;else if(o._latlngs&&o._bounds){if(_=o._latlngs[0],_.length<4)return toastr.error("Minimum 4 points required!","Error"),null;self.Polygon=o,self.Polygon.setStyle({color:"#16FF00",fillColor:"#16FF00",fillOpacity:.1})}else return toastr.error("Please make 1 Geofencing!","Error"),null;self.drawControlFull.remove(),y.addLayer(self.Polygon);var e="",a="";if($.each(self.Polygon._latlngs,function(r,u){$.each(u,function(f,l){f===0&&(a=`${l.lng} ${l.lat}`),e+=`${l.lng} ${l.lat}, `})}),console.log(`${e}${a}`),e)switch(p){case 2:T(`${e}${a}`);break;case 3:S({closeOnConfirm:!1,closeOnCancel:!1,content:{element:"input",attributes:{placeholder:"Type section name",type:"text"}}}).then(r=>{r?k(r,`${e}${a}`):(c(s,i),t.addControl(drawControlFull),t.removeLayer(self.Polygon),d())});break;case 4:P(`${e}${a}`);break}else toastr.error("Failed to read LatLng.")});t.on(L.Draw.Event.DELETED,function(n){var o=n.layers;o.eachLayer(function(e){self.Circle=null,self.Polygon=null,_=[],self.drawControlEdit.remove(),self.drawControlFull.addTo(t)})});function b(n){var o={type:"FeatureCollection",name:"section",features:w},e={};function a(u){let f="#16FF00",l=u.properties;return l.ftsection_name&&(e[l.ftsection_name]||(e[l.ftsection_name]=window.randomHexColor()),f=e[l.ftsection_name]),{pane:"pane_Section",shape:"circle",radius:4,opacity:1,color:f,dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!0,fillOpacity:1,fillColor:f,interactive:!0}}function r(u,f){let l=u.properties,v=`<ul style="list-style-type: none; margin: 0; padding: 0;">
        <li style="font-weight: bold;">Name: ${l.ftsection_name}</li>
        <li style="font-weight: bold;">Type: ${l.fbfly_over?"Flyover":"Street"}</li>
        <li style="font-weight: bold;">Elevation: ${l.ffelevation?l.ffelevation:"n/a"} Meter</li>`;l.ftsection_name&&f.bindTooltip(v).openTooltip()}n.createPane("pane_Section"),n.getPane("pane_Section").style.zIndex=402,n.getPane("pane_Section").style["mix-blend-mode"]="normal",g=new L.geoJson(o,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",onEachFeature:r,pointToLayer:function(u,f){return L.shapeMarker(f,a(u))}}),n.addLayer(g)}var p=0;$("input[name='ckScanPoints']").change(function(){p=0,t.removeLayer(y),t.removeControl(drawControlFull),d(),c(s,i)});$("input[name='ckAddPoints']").change(function(){p=1,t.removeLayer(y),t.removeControl(drawControlFull),d(),c(s,i)});$("input[name='ckDelPoints']").change(function(){p=2,t.addControl(drawControlFull),d(),c(s,i)});$("input[name='ckAddTollSection']").change(function(){p=3,t.addControl(drawControlFull),d(),c(s,i)});$("input[name='ckFlyOverLocation']").change(function(){p=4,t.addControl(drawControlFull),d(),c(s,i)});function F(n){var o=new FormData;o.append("_token",$("input[name=_token]").val()),o.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/add`,data:o,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){},success:function(e){var a=e.msg;a.code===200?toastr.success("Saved.","Success"):toastr.error(e.msg.obj,"Error")}})}var s=0,i=0,m=[];function d(){$.each(m,function(n,o){t.removeLayer(m[n])}),m=[]}function T(n){var o=new FormData;o.append("_token",$("input[name=_token]").val()),o.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/delete`,data:o,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(e){$("#formSection").css("opacity","");var a=e.msg;a.code===200?(toastr.success("Point deleted.","Success"),c(s,i),t.addControl(drawControlFull),t.removeLayer(self.Polygon),d()):toastr.error(e.msg.obj,"Error")}})}function k(n,o){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("section_name",n),e.append("latlng",o),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/set_section`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(a){console.log("res",a),toastr.success("","Success"),c(s,i),t.addControl(drawControlFull),t.removeLayer(self.Polygon),d()},error:function(a){console.log(a);let r=JSON.parse(a.responseText);toastr.error(r.error,"Error")},complete:function(){$("#formSection").css("opacity","")}})}function P(n){var o=new FormData;o.append("_token",$("input[name=_token]").val()),o.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/set_section_elevation`,data:o,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(e){console.log("res",e),toastr.success("","Success"),c(s,i),t.addControl(drawControlFull),t.removeLayer(self.Polygon),d()},error:function(e){console.log(e);let a=JSON.parse(e.responseText);toastr.error(a.error,"Error")},complete:function(){$("#formSection").css("opacity","")}})}L.DomUtil.addClass(t._container,"crosshair-cursor-enabled");t.on("click",function(n){s=n.latlng.lat,i=n.latlng.lng;var o={lat:n.latlng.lat,lng:n.latlng.lng};switch(p){case 0:c(s,i);break;case 1:e&&t.removeLayer(e);var e=window._newMarker(o,{icon:L.icon({iconUrl:"/assets/images/leaflet/marker-reddot.png",iconSize:[8,16],iconAnchor:[5,12]}),interactive:!1});e.addTo(t),m.push(e),F(JSON.stringify(e._latlng));break}});function c(n,o){g&&t.removeLayer(g),w=[],$.get(`${window.burl}/devtools/js/tollsectionpoint?latlng=${n},${o}`,function(e){$.each(e.data,function(a,r){w.push({type:"Feature",properties:{ftsection_name:r.ftsection_name,ffelevation:r.ffelevation,fbfly_over:r.fbfly_over},geometry:{type:"Point",coordinates:[parseFloat(r.fflon),parseFloat(r.fflat)]}})}),e.data.length!=0&&b(t)})}
