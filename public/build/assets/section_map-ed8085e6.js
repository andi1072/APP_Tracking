import"./leaflet-svg-shape-markers-8f7f1e58.js";var m=L.tileLayer(window.mapLayerOpenStreet,{minZoom:5}),o=new L.Map("sectionmap",{center:new L.LatLng(.339951,120.373368),zoom:5,attributionControl:!1,fullscreenControl:!0}),l=L.featureGroup(),d=[],s,f=[],_=L.tileLayer(window.mapLayerOpenStreet,{attribution:""});_.addTo(o);L.Control.geocoder().addTo(o);L.control.layers({osm:m.addTo(o),google:L.tileLayer("http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",{attribution:"google"})},{drawlayer:l},{position:"topright",collapsed:!1}).addTo(o);self.drawControlFull=new L.Control.Draw({edit:{featureGroup:l,poly:{allowIntersection:!1}},draw:{polygon:{allowIntersection:!1,showArea:!0},polyline:!1,rectangle:!1,marker:!1,circle:!1,circlemarker:!1}});self.drawControlEdit=new L.Control.Draw({edit:{featureGroup:l,poly:{allowIntersection:!1}},draw:!1});o.on(L.Draw.Event.CREATED,function(n){if(self.Polygon||self.Circle)return alert("You can only create 1 location per geofence"),null;var e=n.layer;if(e._latlng&&e._mRadius)window.circle=e;else if(e._latlngs&&e._bounds){if(f=e._latlngs[0],f.length<4)return alert("Minimum 4 points required!"),null;self.Polygon=e,self.Polygon.setStyle({color:"#16FF00",fillColor:"#16FF00",fillOpacity:.1})}else return swal("Please make 1 Geofencing!","","Warning"),null;self.drawControlFull.remove(),l.addLayer(e);var a="",t="";$.each(self.Polygon._latlngs,function(r,y){$.each(y,function(w,i){w===0&&(t=`${i.lng} ${i.lat}`),a+=`${i.lng} ${i.lat}, `})}),console.log(`${a}${t}`),v(`${a}${t}`)});o.on(L.Draw.Event.DELETED,function(n){var e=n.layers;e.eachLayer(function(a){self.Circle=null,self.Polygon=null,f=[],self.drawControlEdit.remove(),self.drawControlFull.addTo(o)})});function C(n){var e={type:"FeatureCollection",name:"section",features:d};function a(){return{pane:"pane_Section",shape:"circle",radius:4,opacity:1,color:"#F6FA70",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!1,fillOpacity:1,fillColor:"#F6FA70",interactive:!1}}n.createPane("pane_Section"),n.getPane("pane_Section").style.zIndex=402,n.getPane("pane_Section").style["mix-blend-mode"]="normal",s=new L.geoJson(e,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",pointToLayer:function(t,r){return L.shapeMarker(r,a())}}),n.addLayer(s)}var c=0;$("input[name='ckScanPoints']").change(function(){c=0,o.removeLayer(l),o.removeControl(drawControlFull)});$("input[name='ckAddPoints']").change(function(){c=1,o.removeLayer(l),o.removeControl(drawControlFull)});$("input[name='ckDelPoints']").change(function(){c=2,l.addTo(o),o.addControl(drawControlFull)});function S(n){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/add`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){},success:function(a){var t=a.msg;t.code===200?toastr.success("Saved.","Success"):toastr.error(a.msg.obj,"Error")}})}var u=0,p=0;function v(n){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/delete`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(a){$("#formSection").css("opacity","");var t=a.msg;t.code===200?(toastr.success("Point deleted.","Success"),g(u,p),o.addControl(drawControlFull)):toastr.error(a.msg.obj,"Error")}})}L.DomUtil.addClass(o._container,"crosshair-cursor-enabled");o.on("click",function(n){u=n.latlng.lat,p=n.latlng.lng;var e={lat:n.latlng.lat,lng:n.latlng.lng};switch(c){case 0:g(u,p);break;case 1:var a=window._newMarker(e,{icon:L.icon({iconUrl:"/assets/images/leaflet/marker-reddot.png",iconSize:[8,16],iconAnchor:[5,14]}),interactive:!1});a.addTo(o),S(JSON.stringify(a._latlng));break;case 2:break;default:console.log("No Action")}});function g(n,e){s&&o.removeLayer(s),d=[],$.get(`${window.burl}/devtools/js/tollsectionpoint?latlng=${n},${e}`,function(a){$.each(a.data,function(t,r){d.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[parseFloat(r.fflon),parseFloat(r.fflat)]}})}),a.data.length!=0&&C(o)})}
