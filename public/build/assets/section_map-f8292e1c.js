import"./leaflet-svg-shape-markers-8f7f1e58.js";var g=L.tileLayer(window.mapLayerOpenStreet,{minZoom:5}),o=new L.Map("sectionmap",{center:new L.LatLng(.339951,120.373368),zoom:5,attributionControl:!1,fullscreenControl:!0}),r=L.featureGroup(),d=[],p,f=[],y=[],w=L.tileLayer(window.mapLayerOpenStreet,{attribution:""});w.addTo(o);L.Control.geocoder().addTo(o);L.control.layers({osm:g.addTo(o),google:L.tileLayer("http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",{attribution:"google"})},{drawlayer:r},{position:"topright",collapsed:!1}).addTo(o);self.drawControlFull=new L.Control.Draw({edit:{featureGroup:r,poly:{allowIntersection:!1}},draw:{polygon:{allowIntersection:!1,showArea:!0},polyline:!1,rectangle:!1,marker:!1,circle:!1,circlemarker:!1}});self.drawControlEdit=new L.Control.Draw({edit:{featureGroup:r,poly:{allowIntersection:!1}},draw:!1});o.on(L.Draw.Event.CREATED,function(n){if(self.Polygon||self.Circle)return alert("You can only create 1 location per geofence"),null;var e=n.layer;if(e._latlng&&e._mRadius)window.circle=e;else if(e._latlngs&&e._bounds){if(f=e._latlngs[0],f.length<4)return alert("Minimum 4 points required!"),null;self.Polygon=e,self.Polygon.setStyle({color:"#16FF00",fillColor:"#16FF00",fillOpacity:.1})}else return swal("Please make 1 Geofencing!","","Warning"),null;self.drawControlFull.remove(),self.drawControlEdit.addTo(o),r.addLayer(e);var a="",l="";$.each(self.Polygon._latlngs,function(i,s){$.each(s,function(u,t){u===0&&(l=`${t.lng} ${t.lat}`),a+=`${t.lng} ${t.lat}, `})}),console.log(`${a}${l}`),h(`${a}${l}`)});o.on(L.Draw.Event.DELETED,function(n){var e=n.layers;e.eachLayer(function(a){self.Circle=null,self.Polygon=null,f=[],self.drawControlEdit.remove(),self.drawControlFull.addTo(o)})});function m(n){var e={type:"FeatureCollection",name:"section",features:d};function a(){return{pane:"pane_Section",shape:"circle",radius:4,opacity:1,color:"#000000",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!1,fillOpacity:1,fillColor:"#000000",interactive:!1}}n.createPane("pane_Section"),n.getPane("pane_Section").style.zIndex=402,n.getPane("pane_Section").style["mix-blend-mode"]="normal",p=new L.geoJson(e,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",pointToLayer:function(l,i){return L.shapeMarker(i,a())}}),n.addLayer(p)}var c=0;$("input[name='ckScanPoints']").change(function(){c=0,o.removeLayer(r),o.removeControl(drawControlFull)});$("input[name='ckAddPoints']").change(function(){c=1,o.removeLayer(r),o.removeControl(drawControlFull)});$("input[name='ckDelPoints']").change(function(){c=2,console.log("change deleted"),r.addTo(o),o.addControl(drawControlFull)});function _(n){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/add`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){},success:function(a){var l=a.msg;l.code===200?toastr.success("Saved.","Success"):toastr.error(a.msg.obj,"Error")}})}function h(n){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/delete`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){},success:function(a){var l=a.msg;l.code===200?toastr.success("Point deleted.","Success"):(console.log(a),toastr.error(a.msg.obj,"Error"))}})}L.DomUtil.addClass(o._container,"crosshair-cursor-enabled");o.on("click",function(n){var e=n.latlng.lat,a=n.latlng.lng,l={lat:n.latlng.lat,lng:n.latlng.lng};switch(c){case 0:d=[],$.get(`${window.burl}/devtools/js/tollsectionpoint?latlng=${e},${a}`,function(s){$.each(s.data,function(u,t){d.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[parseFloat(t.fflon),parseFloat(t.fflat)]}}),y.push([parseFloat(t.fflon),parseFloat(t.fflat)])}),s.data.length!=0&&m(o)});break;case 1:var i=window._newMarker(l,{icon:L.icon({iconUrl:"/assets/images/leaflet/marker-reddot.png",iconSize:[8,16],iconAnchor:[5,14]}),interactive:!1});i.addTo(o),_(JSON.stringify(i._latlng));break;case 2:break;default:console.log("No Action")}});
