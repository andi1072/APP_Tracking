import"./leaflet-svg-shape-markers-8f7f1e58.js";import{s as v}from"./sweetalert.min-9dab74b7.js";import"./_commonjsHelpers-725317a4.js";var S=L.tileLayer(window.mapLayerOpenStreet,{minZoom:5}),t=new L.Map("sectionmap",{center:new L.LatLng(.339951,120.373368),zoom:5,attributionControl:!1,fullscreenControl:!0}),m=L.featureGroup(),w=[],g,_=[],h=L.tileLayer(window.mapLayerOpenStreet,{attribution:""});h.addTo(t);L.Control.geocoder().addTo(t);L.control.layers({osm:S.addTo(t),google:L.tileLayer("http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",{attribution:"google"})},{},{position:"topright",collapsed:!1}).addTo(t);self.drawControlFull=new L.Control.Draw({edit:{featureGroup:m,poly:{allowIntersection:!1}},draw:{polygon:{allowIntersection:!1,showArea:!0},polyline:!1,rectangle:!1,marker:!1,circle:!1,circlemarker:!1}});self.drawControlEdit=new L.Control.Draw({edit:{featureGroup:m,poly:{allowIntersection:!1}},draw:!1});t.on(L.Draw.Event.CREATED,function(n){var o=n.layer;if(o._latlng&&o._mRadius)window.circle=o;else if(o._latlngs&&o._bounds){if(_=o._latlngs[0],_.length<4)return toastr.error("Minimum 4 points required!","Error"),null;self.Polygon=o,self.Polygon.setStyle({color:"#16FF00",fillColor:"#16FF00",fillOpacity:.1})}else return toastr.error("Please make 1 Geofencing!","Error"),null;self.drawControlFull.remove(),m.addLayer(self.Polygon);var e="",a="";if($.each(self.Polygon._latlngs,function(l,d){$.each(d,function(i,r){i===0&&(a=`${r.lng} ${r.lat}`),e+=`${r.lng} ${r.lat}, `})}),console.log(`${e}${a}`),e)switch(p){case 2:b(`${e}${a}`);break;case 3:v({closeOnConfirm:!1,closeOnCancel:!1,content:{element:"input",attributes:{placeholder:"Type section name",type:"text"}}}).then(l=>{l?P(l,`${e}${a}`):(f(s,c),t.addControl(drawControlFull),t.removeLayer(self.Polygon),u())})}else toastr.error("Failed to read LatLng.")});t.on(L.Draw.Event.DELETED,function(n){var o=n.layers;o.eachLayer(function(e){self.Circle=null,self.Polygon=null,_=[],self.drawControlEdit.remove(),self.drawControlFull.addTo(t)})});function T(n){var o={type:"FeatureCollection",name:"section",features:w},e={};function a(d){let i="#16FF00",r=d.properties;return r.ftsection_name&&(e[r.ftsection_name]||(e[r.ftsection_name]=window.randomHexColor()),i=e[r.ftsection_name]),{pane:"pane_Section",shape:"circle",radius:4,opacity:1,color:i,dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!0,fillOpacity:1,fillColor:i,interactive:!0}}function l(d,i){let r=d.properties,C=`TOLL SECTION NAME : ${r.ftsection_name} </br>ELEVATION : ${r.ffelevation?r.ffelevation:"n/a"} meter`;r.ftsection_name&&i.bindTooltip(C).openTooltip()}n.createPane("pane_Section"),n.getPane("pane_Section").style.zIndex=402,n.getPane("pane_Section").style["mix-blend-mode"]="normal",g=new L.geoJson(o,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",onEachFeature:l,pointToLayer:function(d,i){return L.shapeMarker(i,a(d))}}),n.addLayer(g)}var p=0;$("input[name='ckScanPoints']").change(function(){p=0,t.removeLayer(m),t.removeControl(drawControlFull),u(),f(s,c)});$("input[name='ckAddPoints']").change(function(){p=1,t.removeLayer(m),t.removeControl(drawControlFull),u(),f(s,c)});$("input[name='ckDelPoints']").change(function(){p=2,t.addControl(drawControlFull),u(),f(s,c)});$("input[name='ckAddTollSection']").change(function(){p=3,t.addControl(drawControlFull),u(),f(s,c)});function F(n){var o=new FormData;o.append("_token",$("input[name=_token]").val()),o.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/add`,data:o,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){},success:function(e){var a=e.msg;a.code===200?toastr.success("Saved.","Success"):toastr.error(e.msg.obj,"Error")}})}var s=0,c=0,y=[];function u(){$.each(y,function(n,o){t.removeLayer(y[n])}),y=[]}function b(n){var o=new FormData;o.append("_token",$("input[name=_token]").val()),o.append("latlng",n),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/delete`,data:o,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(e){$("#formSection").css("opacity","");var a=e.msg;a.code===200?(toastr.success("Point deleted.","Success"),f(s,c),t.addControl(drawControlFull),t.removeLayer(self.Polygon),u()):toastr.error(e.msg.obj,"Error")}})}function P(n,o){var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("section_name",n),e.append("latlng",o),$.ajax({type:"POST",url:`${window.burl}/tollroute/js/set_section`,data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,beforeSend:function(){$("#formSection").css("opacity",".5")},success:function(a){console.log("res",a),toastr.success("","Success"),f(s,c),t.addControl(drawControlFull),t.removeLayer(self.Polygon),u()},error:function(a){console.log(a);let l=JSON.parse(a.responseText);toastr.error(l.error,"Error")},complete:function(){$("#formSection").css("opacity","")}})}L.DomUtil.addClass(t._container,"crosshair-cursor-enabled");t.on("click",function(n){s=n.latlng.lat,c=n.latlng.lng;var o={lat:n.latlng.lat,lng:n.latlng.lng};switch(p){case 0:f(s,c);break;case 1:e&&t.removeLayer(e);var e=window._newMarker(o,{icon:L.icon({iconUrl:"/assets/images/leaflet/marker-reddot.png",iconSize:[8,16],iconAnchor:[5,12]}),interactive:!1});e.addTo(t),y.push(e),F(JSON.stringify(e._latlng));break}});function f(n,o){g&&t.removeLayer(g),w=[],$.get(`${window.burl}/devtools/js/tollsectionpoint?latlng=${n},${o}`,function(e){$.each(e.data,function(a,l){w.push({type:"Feature",properties:{ftsection_name:l.ftsection_name,ffelevation:l.ffelevation},geometry:{type:"Point",coordinates:[parseFloat(l.fflon),parseFloat(l.fflat)]}})}),e.data.length!=0&&T(t)})}
